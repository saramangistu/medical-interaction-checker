<%- include('../partials/header', { title: "My Account", user: user }) %>

<main class="container">
    <h2>My Account</h2>

    <% if (typeof error !== 'undefined' && error) { %>
        <div class="alert alert-danger"><%= error %></div>
    <% } %>

    <form id="accountForm" action="/account" method="POST" enctype="multipart/form-data" class="form-card">
        <div class="form-group">
            <label>First Name:</label>
            <input type="text" name="firstName" value="<%= user.firstName || '' %>">
        </div>

        <div class="form-group">
            <label>Last Name:</label>
            <input type="text" name="lastName" value="<%= user.lastName || '' %>">
        </div>

        <% if (user.role === 'patient') { %>
            <div class="form-group">
                <label>Birth Date:</label>
                <input type="date" name="birthDate" value="<%= user.birthDate ? new Date(user.birthDate).toISOString().split('T')[0] : '' %>">
                <% if (user.age) { %><small>Age: <%= user.age %></small><% } %>
            </div>

            <div class="form-group">
                <label>Gender:</label>
                <select id="genderSelect" name="gender">
                    <option value="male" <%= user.gender === 'male' ? 'selected' : '' %>>Male</option>
                    <option value="female" <%= user.gender === 'female' ? 'selected' : '' %>>Female</option>
                    <option value="other" <%= user.gender === 'other' ? 'selected' : '' %>>Other</option>
                </select>
            </div>

            <div id="femaleFields" class="form-inline hidden">
                <label><input type="checkbox" name="pregnant" value="true" <%= user.pregnant ? 'checked' : '' %>> Pregnant</label>
                <label><input type="checkbox" name="breastfeeding" value="true" <%= user.breastfeeding ? 'checked' : '' %>> Breastfeeding</label>
            </div>

            <div class="form-group">
                <label>Medical Conditions (comma separated):</label>
                <input type="text" name="medicalConditions" value="<%= (user.medicalConditions || []).join(', ') %>">
            </div>

            <div class="form-group">
                <label>Current Medications (comma separated):</label>
                <input type="text" name="currentMedications" value="<%= (user.currentMedications || []).join(', ') %>">
            </div>
        <% } %>

        <% if (user.role === 'doctor') { %>
            <div class="form-group">
                <label>Specialization:</label>
                <input type="text" name="specialization" value="<%= user.specialization || '' %>">
            </div>
            <div class="form-group">
                <label>License Number:</label>
                <input type="text" name="licenseNumber" value="<%= user.licenseNumber || '' %>">
            </div>
            <div class="form-group">
                <label>Years of Experience:</label>
                <input type="number" name="yearsOfExperience" min="0" value="<%= user.yearsOfExperience || '' %>">
            </div>
        <% } %>

        <div class="form-group">
            <label>Email:</label>
            <input type="email" name="email" value="<%= user.email || '' %>">
        </div>

        <div class="form-group">
            <label>Phone:</label>
            <input type="text" name="phone" value="<%= user.phone || '' %>">
        </div>

        <div class="form-group">
            <label>Profile Image:</label>
            <div class="profile-wrapper">
                <img id="profileImagePreview" src="<%= user.profileImage || '/images/profile/avatar.png' %>" alt="Profile Image" class="profile-preview">
            </div>
            <input type="file" name="profileImage" id="profileImageInput" accept="image/*">
            <small id="imageCheckMsg" class="error-message hidden">Please upload a valid human face image.</small>
        </div>

        <button type="submit" class="btn-primary">Update Account</button>
    </form>

    <% if (user.role === 'patient') { %>
    <form id="deleteForm" action="/account/delete" method="POST" class="mt-3">
        <button type="submit" class="btn-danger">Delete My Account</button>
    </form>
    <% } %>
</main>

<script>
    // JS נשאר זהה
</script>

<%- include('../partials/footer') %>